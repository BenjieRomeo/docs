
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>ZeroTier SDK</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-7128bc82.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-28febf7a.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-a9fde460.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;c&quot;,&quot;rust&quot;,&quot;python&quot;,&quot;csharp&quot;,&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-02375b49.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="c">c</a>
              <a href="#" data-language-name="rust">rust</a>
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="csharp">csharp</a>
              <a href="#" data-language-name="java">java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
          </li>
          <li>
            <a href="#part-1-ping-able-node" class="toc-h1 toc-link" data-title="Part 1. Ping-able Node">Part 1. Ping-able Node</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#initializing-a-node" class="toc-h2 toc-link" data-title="Initializing a node">Initializing a node</a>
                  </li>
                  <li>
                    <a href="#additional-initialization-options" class="toc-h2 toc-link" data-title="Additional initialization options">Additional initialization options</a>
                  </li>
                  <li>
                    <a href="#starting-a-node" class="toc-h2 toc-link" data-title="Starting a node">Starting a node</a>
                  </li>
                  <li>
                    <a href="#no-storage-option" class="toc-h2 toc-link" data-title="No storage option">No storage option</a>
                  </li>
                  <li>
                    <a href="#getting-information-about-your-node" class="toc-h2 toc-link" data-title="Getting information about your node">Getting information about your node</a>
                  </li>
                  <li>
                    <a href="#stopping-a-node" class="toc-h2 toc-link" data-title="Stopping a node">Stopping a node</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#part-2-sockets" class="toc-h1 toc-link" data-title="Part 2. Sockets">Part 2. Sockets</a>
          </li>
          <li>
            <a href="#part-3-central-api" class="toc-h1 toc-link" data-title="Part 3. Central API">Part 3. Central API</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#generating-an-api-token" class="toc-h2 toc-link" data-title="Generating an API token">Generating an API token</a>
                  </li>
                  <li>
                    <a href="#creating-a-network" class="toc-h2 toc-link" data-title="Creating a network">Creating a network</a>
                  </li>
                  <li>
                    <a href="#authorizing-a-node" class="toc-h2 toc-link" data-title="Authorizing a node">Authorizing a node</a>
                  </li>
                  <li>
                    <a href="#changing-network-settings" class="toc-h2 toc-link" data-title="Changing network settings">Changing network settings</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#starting-zerotier" class="toc-h1 toc-link" data-title="Starting ZeroTier">Starting ZeroTier</a>
          </li>
          <li>
            <a href="#joining-a-network" class="toc-h1 toc-link" data-title="Joining a network">Joining a network</a>
          </li>
          <li>
            <a href="#connecting-to-peers" class="toc-h1 toc-link" data-title="Connecting to peers">Connecting to peers</a>
          </li>
          <li>
            <a href="#event-handling" class="toc-h1 toc-link" data-title="Event handling">Event handling</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#node-events" class="toc-h2 toc-link" data-title="Node Events">Node Events</a>
                  </li>
                  <li>
                    <a href="#network-events" class="toc-h2 toc-link" data-title="Network Events">Network Events</a>
                  </li>
                  <li>
                    <a href="#peer-events" class="toc-h2 toc-link" data-title="Peer Events">Peer Events</a>
                  </li>
                  <li>
                    <a href="#address-events" class="toc-h2 toc-link" data-title="Address Events">Address Events</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#error-handling" class="toc-h1 toc-link" data-title="Error handling">Error handling</a>
          </li>
          <li>
            <a href="#common-pitfalls" class="toc-h1 toc-link" data-title="Common pitfalls">Common pitfalls</a>
          </li>
          <li>
            <a href="#thread-model" class="toc-h1 toc-link" data-title="Thread model">Thread model</a>
          </li>
          <li>
            <a href="#debugging" class="toc-h1 toc-link" data-title="Debugging">Debugging</a>
          </li>
          <li>
            <a href="#api-design-philosophy" class="toc-h1 toc-link" data-title="API Design Philosophy">API Design Philosophy</a>
          </li>
          <li>
            <a href="#kittens" class="toc-h1 toc-link" data-title="Kittens">Kittens</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#get-all-kittens" class="toc-h2 toc-link" data-title="Get All Kittens">Get All Kittens</a>
                  </li>
                  <li>
                    <a href="#get-a-specific-kitten" class="toc-h2 toc-link" data-title="Get a Specific Kitten">Get a Specific Kitten</a>
                  </li>
                  <li>
                    <a href="#delete-a-specific-kitten" class="toc-h2 toc-link" data-title="Delete a Specific Kitten">Delete a Specific Kitten</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#errors" class="toc-h1 toc-link" data-title="Errors">Errors</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://www.zerotier.com'>ZeroTier Homepage</a></li>
            <li><a href='#'>Sign Up for Central API Key</a></li>
            <li><a href='https://github.com/zerotier/libzt'>GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='getting-started'>Getting Started</h1>
<p><em>Programmatically join, create, and administer secure, globally-available virtual private networks of unlimited size.</em></p>

<p>This is a multi-part tutorial on how to use the ZeroTier SDK. It generally progresses from beginner topics to advanced topics and is meant to be read linearly. For the purposes of this tutorial it is recommended that you first <a href="https://my.zerotier.com">create an account</a> and a private network to test on, but it is not strictly necessary if you&#39;re comfortable joining public networks.</p>

<blockquote>
<p>tl;dr</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="cp">#include &lt;ZeroTierSockets.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">zts_node_start</span><span class="p">();</span>
  <span class="n">zts_net_join</span><span class="p">(</span><span class="mh">0x1234567890abcdef</span><span class="p">);</span>
  <span class="c1">// ...</span>
  <span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="n">zts_socket</span><span class="p">(</span><span class="n">ZTS_AF_INET</span><span class="p">,</span> <span class="n">ZTS_SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">zts_connect</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">in4</span><span class="p">,</span> <span class="n">adddrlen</span><span class="p">);</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="n">zts_node_stop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code>  <span class="k">print</span><span class="p">(</span><span class="s">"Starting ZeroTier..."</span><span class="p">)</span>
  <span class="n">event_callback</span> <span class="o">=</span> <span class="n">MyEventCallbackClass</span><span class="p">()</span>
  <span class="n">libzt</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">key_file_path</span><span class="p">,</span> <span class="n">event_callback</span><span class="p">,</span> <span class="n">zt_service_port</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Waiting for node to come online..."</span><span class="p">)</span>
  <span class="k">while</span> <span class="ow">not</span> <span class="n">is_online</span><span class="p">:</span>
      <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Joining network:"</span><span class="p">,</span> <span class="nb">hex</span><span class="p">(</span><span class="n">network_id</span><span class="p">))</span>
  <span class="n">libzt</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">network_id</span><span class="p">)</span>
  <span class="k">while</span> <span class="ow">not</span> <span class="n">is_joined</span><span class="p">:</span>
      <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">"Joined network"</span><span class="p">)</span>
</code></pre></div>
<aside class="success">
Full example source code: <a href="https://github.com/zerotier/libzt/tree/master/examples">libzt/examples</a>
</aside>

<p>For API reference documentation see the following:</p>

<ul>
<li><a href="#">C/C++ (Doxygen)</a></li>
<li><a href="#">C# (Doxygen)</a></li>
<li><a href="#">Java (javadoc)</a></li>
<li><a href="#">Python (pydoc)</a></li>
</ul>
<h1 id='part-1-ping-able-node'>Part 1. Ping-able Node</h1>
<p>In this part we will initialize a node, start it and join our public <code>earth</code> network. Once joined you can also join a desktop client and ping your new globally static IPv4 (or IPv6) address.</p>

<aside class="warning">
Security note: Since <code>earth</code> is a public network it is recommended that you create an account and a private network of your own to test on.
</aside>
<h2 id='initializing-a-node'>Initializing a node</h2>
<p>Before you start a node you should consider the following initialization options.</p>

<p><code>zts_init_*</code> functions should be called before starting your node. They don&#39;t do much except instruct your node how to operate after you call <code>zts_node_start()</code>. Every node needs an <code>identity</code>. You have a few options:</p>

<p>Generate a new one:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_init_new_identity</span><span class="p">()</span>
</code></pre></div>
<p>Load from storage (will generate new identity if path is empty or does not exist):
<code>c
zts_init_from_storage(&quot;./node_path&quot;)
</code>
Load from memory:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_init_from_memory</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">len</span><span class="p">)</span>
</code></pre></div>
<p><em>An identity is a verifiable address that networks and other nodes can use to talk to your node at a low level.</em></p>
<h2 id='additional-initialization-options'>Additional initialization options</h2>
<p>There are a few other initialization functions to customize the behavior of your node which must be called before <code>zts_node_start()</code>:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_init_port</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">);</span> <span class="c1">// Bind to specific port</span>
<span class="n">zts_init_callback</span><span class="p">(</span><span class="o">&amp;</span><span class="n">my_event_handler</span><span class="p">);</span> <span class="c1">// Set callback function</span>
<span class="n">zts_start</span><span class="p">();</span>
<span class="p">...</span>
</code></pre></div><h2 id='starting-a-node'>Starting a node</h2>
<p>A ZeroTier node needs an <code>identity</code>. . When you start a node for the first time it will generate a new identity automatically. That is, unless you told it where to find an identity that you already have. We&#39;ll get to that in a moment.</p>

<p>Here&#39;s a minimal pingable IPv4 program:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_init_from_storage</span><span class="p">(</span><span class="s">"./node_identity_files"</span><span class="p">);</span>
<span class="n">zts_node_start</span><span class="p">();</span>
</code></pre></div>
<p>This method will first check the directory for an identity file:
 - If it is found it will load it and use that identity.
 - If the directory is empty the node will generate a new identity and write it to files <code>identity.secret</code> and <code>identity.public</code>.
 - Will automatically take care of all peer, network and planet caching.</p>

<p><em>You should keep your identity files safe and unique! If anyone gets ahold of these files they can impersonate your node. And if you run two nodes with the same identities you will have a bad day.</em></p>
<h2 id='no-storage-option'>No storage option</h2>
<p>If instead you have an identity in memory that you&#39;d like to use, you can do the following:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_init_from_memory</span><span class="p">(</span><span class="n">identity</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="n">zts_node_start</span><span class="p">();</span>
</code></pre></div>
<p>If you use the above option, nothing will be read from or written to storage. If you are interested in caching things like peer connectivity hints, network config, etc., you will need to do that manually via the callback system discussed later.</p>
<h2 id='getting-information-about-your-node'>Getting information about your node</h2>
<p>After your node is</p>
<h2 id='stopping-a-node'>Stopping a node</h2>
<blockquote>
<p>If you&#39;re done using ZeroTier and want to stop the node, call:</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_node_stop</span><span class="p">();</span>
</code></pre></div>
<p>It is possible re-start the node just by calling <code>zts_node_start()</code>. No re-initialization is necessary.</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_node_restart</span><span class="p">();</span>
</code></pre></div>
<p>If however you are absolutely certain you are done and want all threads to cease operation and for resources to be completely freed, call:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_node_free</span><span class="p">();</span>
</code></pre></div>
<blockquote>
<p>tl;dr</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="cp">#include &lt;stdio.h&gt;
#include "ZeroTierSockets.h"
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Starting node...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">zts_node_start</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Waiting for node to come online</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">zts_node_is_online</span><span class="p">())</span>
        <span class="n">zts_delay_ms</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Node identity is: %llx</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">zts_node_get_id</span><span class="p">());</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Joining network</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="kt">uint64_t</span> <span class="n">network</span> <span class="o">=</span> <span class="mh">0x8286ac0e47a6f241</span><span class="p">;</span>
    <span class="n">zts_net_join</span><span class="p">(</span><span class="n">network</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Waiting for join to complete. Did you authorize it?</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">zts_net_count</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">zts_delay_ms</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Waiting for address assignment</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="n">err</span> <span class="o">=</span> <span class="n">zts_addr_is_assigned</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">ZTS_AF_INET</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"err = %d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
        <span class="n">zts_delay_ms</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">char</span> <span class="n">ipstr</span><span class="p">[</span><span class="n">ZTS_INET6_ADDRSTRLEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">zts_addr_get_str</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">ZTS_AF_INET</span><span class="p">,</span> <span class="n">ipstr</span><span class="p">,</span> <span class="n">ZTS_INET6_ADDRSTRLEN</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Ping me at %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ipstr</span><span class="p">);</span>

    <span class="c1">// Do network stuff!</span>

    <span class="n">zts_delay_ms</span><span class="p">(</span><span class="mi">120000</span><span class="p">);</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Stopping node</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">zts_node_stop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>Program output</p>
<div class="highlight"><pre class="highlight plaintext"><code>Starting node...
Waiting for node to come online
Node identity is: 123456abcd
Joining network
Waiting for join to complete. Did you authorize it?
Waiting for address assignment
Ping me at 172.22.22.1
Stopping node
</code></pre></div><h1 id='part-2-sockets'>Part 2. Sockets</h1>
<p>ZeroTier provides a socket interface that idiomatic to each supported language.</p>
<h1 id='part-3-central-api'>Part 3. Central API</h1>
<p>This section will show you how to use the built-in Central API to make calls to our hosted endpoints using your language of choice. It is not necessary to use these built in features but they are provided as a convenience.</p>

<aside class="notice">
The Central client functionality built into libzt is a lagging subset of what is available at <a href="https://apidocs.zerotier.com/">apidocs.zerotier.com</a>. That being said, it should provide for most of your needs.
</aside>
<h2 id='generating-an-api-token'>Generating an API token</h2><h2 id='creating-a-network'>Creating a network</h2><h2 id='authorizing-a-node'>Authorizing a node</h2><h2 id='changing-network-settings'>Changing network settings</h2><h1 id='starting-zerotier'>Starting ZeroTier</h1>
<p>The next few sections explain how to use the network control interface portion of the API. These functions are non-blocking and will return an error code specified in the <a href="#error-handling">Error Handling</a> section and will result in the generation of callback events detailed in the <a href="#event-handling">Event Handling</a> section. It is your responsibility to handle these events.</p>

<p>To start the service, simply call:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_start</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="kt">uint16_t</span> <span class="n">port</span><span class="p">);</span>
<span class="n">zts_callback_msg</span><span class="o">*</span><span class="p">),</span> <span class="kt">int</span> <span class="n">port</span><span class="p">)</span><span class="err">`</span>
</code></pre></div>
<p>At this stage, if a cryptographic identity for this node does not already exist on your local storage medium, it will generate a new one and store it, the node&#39;s address (commonly referred to as <code>nodeId</code>) will be derived from this identity and will be presented to you upon receiving the <code>ZTS_EVENT_NODE_ONLINE</code> shown below. The first argument <code>path</code> is a path where you will direct ZeroTier to store its automatically-generated cryptographic identity files (<code>identity.public</code> and <code>identity.secret</code>), these files are your keys to communicating on the network. Keep them safe and keep them unique. If any two nodes are online using the same identities you will have a bad time. The second argument <code>userCallbackFunc</code> is a function that you specify to handle all generated events for the life of your program, see below:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="cp">#include "ZeroTierSockets.h"
</span>
<span class="p">...</span>

<span class="n">bool</span> <span class="n">networkReady</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">on_zts_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">zts_callback_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">eventCode</span> <span class="o">==</span> <span class="n">ZTS_EVENT_NODE_ONLINE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ZTS_EVENT_NODE_ONLINE, nodeId=%llx</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">address</span><span class="p">);</span>
        <span class="n">networkReady</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">zts_start</span><span class="p">(</span><span class="s">"configPath"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">on_zts_event</span><span class="p">,</span> <span class="mi">9994</span><span class="p">);</span>
    <span class="kt">uint64_t</span> <span class="n">nwid</span> <span class="o">=</span> <span class="mh">0x0123456789abcdef</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">networkReady</span><span class="p">)</span> <span class="p">{</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">}</span>
    <span class="n">zts_join</span><span class="p">(</span><span class="n">nwid</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">zts_socket</span><span class="p">(</span><span class="n">ZTS_AF_INET</span><span class="p">,</span> <span class="n">ZTS_SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div>
<p>For more complete examples see <code>./examples/</code></p>

<p>After calling <code>zts_start()</code> you will receive one or more events specified in the <a href="#node-events">Node Events</a> section. After receiving <code>ZTS_EVENT_NODE_ONLINE</code> you will be allowed to join or leave networks. You must authorize the node ID provided by the this callback event to join your network. This can be done manually or via our <a href="https://my.zerotier.com/help/api">Web API</a>. Note however that if you are using an Ad-hoc network, it has no controller and therefore requires no authorization.</p>

<p>At the end of your program or when no more network activity is anticipated, the user application can shut down the service with <code>zts_stop()</code>. However, it is safe to leave the service running in the background indefinitely as it doesn&#39;t consume much memory or CPU while at idle. <code>zts_stop()</code> is a non-blocking call and will itself issue a series of events indicating that various aspects of the ZeroTier service have successfully shut down.</p>

<p>It is worth noting that while <code>zts_stop()</code> will stop the service, the user-space network stack will continue operating in a headless hibernation mode. This is intended behavior due to the fact that the network stack we&#39;ve chosen doesn&#39;t currently support the notion of shutdown since it was initially designed for embedded applications that are simply switched off. If you do need a way to shut everything down and free all resources you can call <code>zts_free()</code>, but please note that calling this function will prevent all subsequent <code>zts_start()</code> calls from succeeding and will require a full application restart if you want to run the service again. The events <code>ZTS_EVENT_NODE_ONLINE</code> and <code>ZTS_EVENT_NODE_OFFLINE</code> can be seen periodically throughout the lifetime of your application depending on the reliability of your underlying network link, these events are lagging indicators and are typically only triggered every thirty (30) seconds.</p>

<p>Lastly, the function <code>zts_restart()</code> is provided as a way to restart the ZeroTier service along with all of its virtual interfaces. The network stack will remain online and undisturbed during this call. Note that this call will temporarily block until the service has fully shut down, then will return and you may then watch for the appropriate startup callbacks mentioned above.</p>
<h1 id='joining-a-network'>Joining a network</h1>
<p>Joining a ZeroTier virtual network is as easy as calling <code>zts_join(uint64_t networkId)</code>. Similarly there is a <code>zts_leave(uint64_t networkId)</code>. Note that <code>zts_start()</code> must be called and a <code>ZTS_EVENT_NODE_ONLINE</code> event must have been received before these calls will succeed. After calling <code>zts_join()</code> any one of the events detailed in the <a href="#network-events">Network Events</a> section may be generated.</p>
<h1 id='connecting-to-peers'>Connecting to peers</h1>
<p>Creating a standard socket connection generally works the same as it would using an ordinary socket interface, however with ZeroTier there is a subtle difference in how connections are established which may cause confusion. Since ZeroTier employs transport-triggered link provisioning a direct connection between peers will not exist until contact has been attempted by at least one peer. During this time before a direct link is available traffic will be handled via our free relay service. The provisioning of this direct link usually only takes a couple of seconds but it is important to understand that if you attempt something like s <code>zts_connect(...)</code> call during this time it may fail due to packet loss. Therefore it is advised to repeatedly call <code>zts_connect(...)</code> until it succeeds and to wait to send additional traffic until <code>ZTS_EVENT_PEER_DIRECT</code> has been received for the peer you are attempting to communicate with. All of the above is optional, but it will improve your experience.</p>

<p><code>tl;dr: Try a few times and wait a few seconds</code></p>

<p>As a mitigation for the above behavior, ZeroTier will by default cache details about how to contact a peer in the <code>peers.d</code> subdirectory of the config path you passed to <code>zts_start(...)</code>. In scenarios where paths do not often change, this can almost completely eliminate the issue and will make connections nearly instantaneous. If however you do not wish to cache these details you can disable it via <code>zts_set_peer_caching(false)</code>.</p>
<h1 id='event-handling'>Event handling</h1>
<p>As mentioned in previous sections, the control API works by use of non-blocking calls and the generation of a few dozen different event types. Depending on the type of event there may be additional contextual information attached to the <code>zts_callback_msg</code> object that you can use. This contextual information will be housed in one of the following structures which are defined in <code>include/ZeroTierSockets.h</code>:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="k">struct</span> <span class="n">zts_callback_msg</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">eventCode</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_node_details</span> <span class="o">*</span><span class="n">node</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_network_details</span> <span class="o">*</span><span class="n">network</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_netif_details</span> <span class="o">*</span><span class="n">netif</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_virtual_network_route</span> <span class="o">*</span><span class="n">route</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_peer_details</span> <span class="o">*</span><span class="n">peer</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">zts_addr_details</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>Here&#39;s an example of a callback function:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="kt">void</span> <span class="nf">on_zts_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">zts_callback_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">-&gt;</span><span class="n">eventCode</span> <span class="o">==</span> <span class="n">ZTS_EVENT_NODE_ONLINE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"ZTS_EVENT_NODE_ONLINE, node=%llx</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">msg</span><span class="o">-&gt;</span><span class="n">node</span><span class="o">-&gt;</span><span class="n">address</span><span class="p">);</span>
        <span class="c1">// You can join networks now!</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In this callback function you can perform additional non-blocking API calls or other work. While not returning control to the service isn&#39;t forbidden (the event messages are generated by a separate thread) it is recommended that you return control as soon as possible as not returning will prevent the user application from receiving additional callback event messages which may be time-sensitive.</p>

<p>A typical ordering of messages may look like the following:</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="p">...</span>
<span class="n">ZTS_EVENT_NODE_ONLINE</span>       <span class="c1">// Your node is ready to be used.</span>
<span class="n">ZTS_EVENT_ADDR_ADDED_IP4</span>    <span class="c1">// Your node received an IP address assignment on a given network.</span>
<span class="n">ZTS_EVENT_NETWORK_UPDATE</span>    <span class="c1">// Something about a network changed.</span>
<span class="n">ZTS_EVENT_NETWORK_READY_IP4</span> <span class="c1">// Your node has joined a network, has an address, and can send/receive traffic.</span>
<span class="n">ZTS_EVENT_PEER_RELAY</span>        <span class="c1">// A peer was discovered but no direct path exists (yet.)</span>
<span class="p">...</span>
<span class="n">ZTS_EVENT_PEER_DIRECT</span>       <span class="c1">// One or more direct paths to a peer were discovered.</span>
</code></pre></div><h2 id='node-events'>Node Events</h2>
<p>Accessible via <code>msg-&gt;node</code> as a <code>zts_node_details</code> object, this message type will contain information about the status of your node. <em>Possible values of <code>msg-&gt;eventCode</code>:</em></p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">ZTS_EVENT_NODE_OFFLINE</span>             <span class="c1">// Your node is offline.</span>
<span class="n">ZTS_EVENT_NODE_ONLINE</span>              <span class="c1">// Your node is online and ready to communicate!</span>
<span class="n">ZTS_EVENT_NODE_DOWN</span>                <span class="c1">// The node is down (for any reason.)</span>
<span class="n">ZTS_EVENT_NODE_IDENTITY_COLLISION</span>  <span class="c1">// There is another node with the same identity causing a conflict.</span>
<span class="n">ZTS_EVENT_NODE_UNRECOVERABLE_ERROR</span> <span class="c1">// Something went wrong internally.</span>
<span class="n">ZTS_EVENT_NODE_NORMAL_TERMINATION</span>  <span class="c1">// Your node has terminated.</span>
</code></pre></div>
<p><em>Example contents of <code>msg-&gt;node</code>:</em></p>
<div class="highlight"><pre class="highlight plaintext"><code>id            : f746d550dd
version       : 1.4.6
primaryPort   : 9995
secondaryPort : 0
</code></pre></div><h2 id='network-events'>Network Events</h2>
<p>Accessible via <code>msg-&gt;network</code> as a <code>zts_network_details</code> object, this message type will contain information about the status of a particular network your node has joined. <em>Possible values of <code>msg-&gt;eventCode</code>:</em></p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">ZTS_EVENT_NETWORK_NOT_FOUND</span>      <span class="c1">// The network does not exist. The provided networkID may be incorrect.</span>
<span class="n">ZTS_EVENT_NETWORK_CLIENT_TOO_OLD</span> <span class="c1">// This client is too old.</span>
<span class="n">ZTS_EVENT_NETWORK_REQ_CONFIG</span>     <span class="c1">// Waiting for network config, this might take a few seconds.</span>
<span class="n">ZTS_EVENT_NETWORK_OK</span>             <span class="c1">// Node successfully joined.</span>
<span class="n">ZTS_EVENT_NETWORK_ACCESS_DENIED</span>  <span class="c1">// The network is private. Your node requires authorization.</span>
<span class="n">ZTS_EVENT_NETWORK_READY_IP4</span>      <span class="c1">// Your node successfully received an IPv4 address.</span>
<span class="n">ZTS_EVENT_NETWORK_READY_IP6</span>      <span class="c1">// Your node successfully received an IPv6 address.</span>
<span class="n">ZTS_EVENT_NETWORK_DOWN</span>           <span class="c1">// For some reason the network is no longer available.</span>
<span class="n">ZTS_EVENT_NETWORK_UPDATE</span>         <span class="c1">// The network's config has changed: mtu, name, managed route, etc.</span>
</code></pre></div>
<p><em>Example contents of <code>msg-&gt;network</code>:</em></p>
<div class="highlight"><pre class="highlight plaintext"><code>nwid                       : 8bd712bf36bdae5f
mac                        : ae53fa031fcf
name                       : cranky_hayes
type                       : 0
mtu                        : 2800
dhcp                       : 0
bridge                     : 0
broadcastEnabled           : 1
portError                  : 0
netconfRevision            : 34
routeCount                 : 1
multicastSubscriptionCount : 1
- mac=ffffffffffff, adi=ac1b2561
addresses:
- FC5D:69B6:E0F7:46D5:50DD::1
- 172.27.37.97
routes:
- target : 172.27.0.0
- via    : 0.0.0.0
  - flags  : 0
  - metric : 0
</code></pre></div><h2 id='peer-events'>Peer Events</h2>
<p>Accessible via <code>msg-&gt;peer</code> as a <code>zts_peer_details</code> object, this message type will contain information about a peer that was discovered by your node. These events are triggered when the reachability status of a peer has changed. <em>Possible values of <code>msg-&gt;eventCode</code>:</em></p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">ZTS_EVENT_PEER_DIRECT</span>          <span class="c1">// At least one direct path to this peer is known.</span>
<span class="n">ZTS_EVENT_PEER_RELAY</span>           <span class="c1">// No direct path to this peer is known. It will be relayed, (high packet loss and jitter.)</span>
<span class="n">ZTS_EVENT_PEER_UNREACHABLE</span>     <span class="c1">// Peer is not reachable by any means.</span>
<span class="n">ZTS_EVENT_PEER_PATH_DISCOVERED</span> <span class="c1">// A new direct path to this peer has been discovered.</span>
<span class="n">ZTS_EVENT_PEER_PATH_DEAD</span>       <span class="c1">// A direct path to this peer has expired.</span>
</code></pre></div>
<p><em>Example contents of <code>msg-&gt;peer</code>:</em></p>
<div class="highlight"><pre class="highlight plaintext"><code>peer      : a747d5502d
role      : 0
latency   : 4
version   : 1.4.6
pathCount : 2
 - 172.27.37.97
 - F75D:69B6:E0C7:47D5:51DB::1
</code></pre></div><h2 id='address-events'>Address Events</h2>
<p>Accessible via <code>msg-&gt;addr</code> as a <code>zts_addr_details</code> object, this message type will contain information about addresses assign to your node on a particular network. The information contained in these events is also available via <code>ZTS_EVENT_NETWORK_UPDATE</code> events. <em>Possible values of <code>msg-&gt;eventCode</code>:</em></p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">ZTS_EVENT_ADDR_ADDED_IP4</span>   <span class="c1">// A new IPv4 address was assigned to your node on the indicated network.</span>
<span class="n">ZTS_EVENT_ADDR_REMOVED_IP4</span> <span class="c1">// An IPv4 address assignment to your node was removed on the indicated network.</span>
<span class="n">ZTS_EVENT_ADDR_ADDED_IP6</span>   <span class="c1">// A new IPv6 address was assigned to your node on the indicated network.</span>
<span class="n">ZTS_EVENT_ADDR_REMOVED_IP6</span> <span class="c1">// An IPv6 address assignment to your node was removed on the indicated network.</span>
</code></pre></div>
<p><em>Example contents of <code>msg-&gt;addr</code>:</em></p>
<div class="highlight"><pre class="highlight plaintext"><code>nwid : a747d5502d
addr : 172.27.37.97
</code></pre></div><h1 id='error-handling'>Error handling</h1>
<p>Calling a <code>zts_*</code> function will result in one of the following return codes. Additionally, <code>zts_errno</code> will be set after each socket call. Its values closely mirror those used in standard socket interfaces and are defined in <a href="#">include/ZeroTierSockets.h</a>.</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="k">enum</span> <span class="n">ZTS_Error</span> <span class="p">{</span>
  <span class="n">ZTS_ERR_OK</span>        <span class="o">=</span>  <span class="mi">0</span><span class="p">,</span> <span class="c1">// No error</span>
  <span class="n">ZTS_ERR_SOCKET</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="c1">// Socket error, see zts_errno</span>
  <span class="n">ZTS_ERR_SERVICE</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="c1">// The node service experienced a problem</span>
  <span class="n">ZTS_ERR_ARG</span>       <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="c1">// Invalid argument</span>
  <span class="n">ZTS_ERR_NO_RESULT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="c1">// No result (not necessarily an error)</span>
  <span class="n">ZTS_ERR_GENERAL</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">5</span>  <span class="c1">// Consider filing a bug report</span>
<span class="p">};</span>
</code></pre></div>
<aside class="notice">
For Android/Java (or similar) which use JNI, the socket API's error codes are negative values encoded in the return values of function calls.
</aside>

<aside class="notice">
For protocol-level errors (such as dropped packets) or internal network stack errors, see the section `Statistics`
</aside>
<h1 id='common-pitfalls'>Common pitfalls</h1>
<ul>
<li><p>If you have started a node but have not received a <code>ZTS_EVENT_NODE_ONLINE</code>:</p>

<ul>
<li>You may need to view our <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/6815768/Router+Configuration+Tips">Router Config Tips</a> knowledge base article. Sometimes this is due to firewall/NAT settings.</li>
</ul></li>
<li><p>If you have received a <code>ZTS_EVENT_NODE_ONLINE</code> event and attempted to join a network but do not see your node ID in the network panel on <a href="my.zerotier.com">my.zerotier.com</a> after some time:</p>

<ul>
<li>You may have typed in your network ID incorrectly.</li>
<li>Used an improper integer representation for your network ID (e.g. <code>int</code> instead of <code>uint64_t</code>).</li>
</ul></li>
<li><p>If you are unable to reliably connect to peers:</p>

<ul>
<li>You should first read the section on <a href="#connecting-and-communicating-with-peers">Connecting and communicating with peers</a>.</li>
<li>If the previous step doesn&#39;t help move onto our knowledge base article <a href="https://zerotier.atlassian.net/wiki/spaces/SD/pages/6815768/Router+Configuration+Tips">Router Config Tips</a>. Sometimes this can be a transport-triggered link issue, and sometimes it can be a firewall/NAT issue.</li>
</ul></li>
<li><p>API calls seem to fail in nonsensical ways and you&#39;re tearing your hair out:</p>

<ul>
<li>Be sure to read and understand the <a href="#api-compatibility-with-host-os">API compatibility with host OS</a> section.</li>
<li>See the <a href="#debugging">Debugging</a> section for more advice.</li>
</ul></li>
<li><p>Since libzt re-implements a socket interface likely very similar to your host OS&#39;s own interface it may be tempting to mix and match host OS structures and functions with those of libzt. This may work on occasion, but you are tempting fate. Here are a few important guidelines:</p></li>
</ul>

<blockquote>
<p>If you are calling a <code>zts_*</code> function, use the appropriate <code>ZTS_*</code> constants:</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">zts_socket</span><span class="p">(</span><span class="n">ZTS_AF_INET6</span><span class="p">,</span> <span class="n">ZTS_SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// CORRECT</span>
<span class="n">zts_socket</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>         <span class="c1">// INCORRECT</span>
</code></pre></div>
<blockquote>
<p>If you are calling a <code>zts_*</code> function, use the appropriate <code>zts_*</code> structure:</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="k">struct</span> <span class="n">zts_sockaddr_in</span> <span class="n">in4</span><span class="p">;</span>  <span class="c1">// Note the zts_ prefix</span>
<span class="n">zts_bind</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">in4</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">zts_sockaddr_in</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>If you are calling a host OS function, use your host OS&#39;s constants (and structures!):</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">in6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">),</span> <span class="p">...);</span>         <span class="c1">// CORRECT</span>
<span class="n">inet_ntop</span><span class="p">(</span><span class="n">ZTS_AF_INET6</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">in6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">),</span> <span class="p">...);</span>     <span class="c1">// INCORRECT</span>
<span class="n">zts_inet_ntop</span><span class="p">(</span><span class="n">ZTS_AF_INET6</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">in6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">),</span> <span class="p">...);</span> <span class="c1">// CORRECT</span>
</code></pre></div>
<blockquote>
<p>If you are calling a host OS function but passing a <code>zts_*</code> structure, this can work sometimes but you should take care to pass the correct host OS constants:</p>
</blockquote>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="k">struct</span> <span class="n">zts_sockaddr_in6</span> <span class="n">in6</span><span class="p">;</span>
    <span class="p">...</span>
<span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET6</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">in6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">),</span> <span class="n">dstStr</span><span class="p">,</span> <span class="n">INET6_ADDRSTRLEN</span><span class="p">);</span>
</code></pre></div><h1 id='thread-model'>Thread model</h1>
<p>Both the <strong>socket</strong> and <strong>control</strong> interfaces are thread-safe but are implemented differently. The socket interface is implemented using a relatively performant core locking mechanism in lwIP. This can be disabled if you know what you&#39;re doing. The control interface is implemented by a single coarse-grained lock. This lock is not a performance bottleneck since it only applies to functions that manipulate the ZeroTier service and are called seldomly. Callback events are generated by a separate thread and are independent from the rest of the API&#39;s internal locking mechanism. Not returning from a callback event won&#39;t impact the rest of the API but it will prevent your application from receiving future events so it is in your application&#39;s best interest to perform as little work as possible in the callback function and promptly return control back to ZeroTier.</p>

<aside class="notice">
Internally, `libzt` will spawn a number of threads for various purposes: a thread for the core service, a thread for the network stack, a low priority thread to process callback events, and a thread for each network joined. The vast majority of work is performed by the core service and stack threads.
</aside>
<h1 id='debugging'>Debugging</h1>
<p>If you&#39;re experiencing odd behavior or something that looks like a bug I would suggest first reading and understanding the following sections:</p>

<ul>
<li><a href="#common-pitfalls">Common pitfalls</a></li>
<li><a href="#api-compatibility-with-host-os">API compatibility with host OS</a></li>
<li><a href="#thread-model">Thread model</a></li>
</ul>

<p>If the information in those sections hasn&#39;t helped, there are a couple of ways to get debug traces out of various parts of the library.</p>

<p>1) Build the library in debug mode with <code>make host_debug</code>. This will prevent the stripping of debug symbols from the library and will enable basic output traces from libzt.</p>

<p>2) If you believe your problem is in the network stack you can manually enable debug traces for individual modules in <a href="#">src/lwipopts.h</a>. Toggle the <code>*_DEBUG</code> types from <code>LWIP_DBG_OFF</code> to <code>LWIP_DBG_ON</code>. And then rebuild. This will come with a significant performance cost.</p>

<p>3) Enabling network stack statistics. This is useful if you want to monitor the stack&#39;s receipt and handling of traffic as well as internal things like memory allocations and cache hits. Protocol and service statistics are available in debug builds of <code>libzt</code>. These statistics are detailed fully in the section of <code>include/ZeroTierSockets.h</code> that is guarded by <code>LWIP_STATS</code>.</p>
<div class="highlight"><pre class="highlight c tab-c"><code><span class="k">struct</span> <span class="n">zts_stats_proto</span> <span class="n">stats</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">zts_get_protocol_stats</span><span class="p">(</span><span class="n">ZTS_STATS_PROTOCOL_ICMP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">)</span> <span class="o">==</span> <span class="n">ZTS_ERR_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"icmp.recv=%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">stats</span><span class="p">.</span><span class="n">recv</span><span class="p">);</span> <span class="c1">// Count of received pings</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">zts_get_protocol_stats</span><span class="p">(</span><span class="n">ZTS_STATS_PROTOCOL_TCP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stats</span><span class="p">)</span> <span class="o">==</span> <span class="n">ZTS_ERR_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"tcp.drop=%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">stats</span><span class="p">.</span><span class="n">drop</span><span class="p">);</span> <span class="c1">// Count of dropped TCP packets</span>
<span class="p">}</span>
</code></pre></div>
<p>4) There are a series of additional events which can signal whether the network stack or its virtual network interfaces have been set up properly. See <code>ZTS_EVENT_STACK_*</code> and <code>ZTS_EVENT_NETIF_*</code>.</p>
<h1 id='api-design-philosophy'>API Design Philosophy</h1>
<p>ZeroTier is written in C++ but exposes two C APIs at different abstraction levels for different purposes. First, there is the <a href="#">Core API</a> which allows you to control a raw node that can securely move Ethernet frames. The core API is for those who need transport options below the socket layer. Second, there is a <a href="#">Socket API</a> (this document). The socket API provides a familiar socket interface and a suite of convenient control functions. This API is recommended for most applications.</p>

<blockquote>
<p>To authorize, use this code:</p>
</blockquote>
<div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'kittn'</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">Kittn</span><span class="o">::</span><span class="no">APIClient</span><span class="p">.</span><span class="nf">authorize!</span><span class="p">(</span><span class="s1">'meowmeowmeow'</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">kittn</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">kittn</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span><span class="s">'meowmeowmeow'</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code><span class="c"># With shell, you can just pass the correct header with each request</span>
curl <span class="s2">"api_endpoint_here"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Authorization: meowmeowmeow"</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">kittn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">kittn</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">kittn</span><span class="p">.</span><span class="nx">authorize</span><span class="p">(</span><span class="dl">'</span><span class="s1">meowmeowmeow</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>Make sure to replace <code>meowmeowmeow</code> with your API key.</p>
</blockquote>

<p>Kittn uses API keys to allow access to the API. You can register a new Kittn API key at our <a href="http://example.com/developers">developer portal</a>.</p>

<p>Kittn expects for the API key to be included in all API requests to the server in a header that looks like the following:</p>

<p><code>Authorization: meowmeowmeow</code></p>

<aside class="notice">
You must replace <code>meowmeowmeow</code> with your personal API key.
</aside>
<h1 id='kittens'>Kittens</h1><h2 id='get-all-kittens'>Get All Kittens</h2><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'kittn'</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">Kittn</span><span class="o">::</span><span class="no">APIClient</span><span class="p">.</span><span class="nf">authorize!</span><span class="p">(</span><span class="s1">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="nf">kittens</span><span class="p">.</span><span class="nf">get</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">kittn</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">kittn</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span><span class="s">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="n">kittens</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="s2">"http://example.com/api/kittens"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Authorization: meowmeowmeow"</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">kittn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">kittn</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">kittn</span><span class="p">.</span><span class="nx">authorize</span><span class="p">(</span><span class="dl">'</span><span class="s1">meowmeowmeow</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">kittens</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">kittens</span><span class="p">.</span><span class="kd">get</span><span class="p">();</span>
</code></pre></div>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fluffums"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"breed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"calico"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fluffiness"</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cuteness"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Max"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"breed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"fluffiness"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"cuteness"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>This endpoint retrieves all kittens.</p>
<h3 id='http-request'>HTTP Request</h3>
<p><code>GET http://example.com/api/kittens</code></p>
<h3 id='query-parameters'>Query Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>include_cats</td>
<td>false</td>
<td>If set to true, the result will also include cats.</td>
</tr>
<tr>
<td>available</td>
<td>true</td>
<td>If set to false, the result will include kittens that have already been adopted.</td>
</tr>
</tbody></table>

<aside class="success">
Remember — a happy kitten is an authenticated kitten!
</aside>
<h2 id='get-a-specific-kitten'>Get a Specific Kitten</h2><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'kittn'</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">Kittn</span><span class="o">::</span><span class="no">APIClient</span><span class="p">.</span><span class="nf">authorize!</span><span class="p">(</span><span class="s1">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="nf">kittens</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">kittn</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">kittn</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span><span class="s">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="n">kittens</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="s2">"http://example.com/api/kittens/2"</span> <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Authorization: meowmeowmeow"</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">kittn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">kittn</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">kittn</span><span class="p">.</span><span class="nx">authorize</span><span class="p">(</span><span class="dl">'</span><span class="s1">meowmeowmeow</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">kittens</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Max"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"breed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"unknown"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fluffiness"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cuteness"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>This endpoint retrieves a specific kitten.</p>

<aside class="warning">Inside HTML code blocks like this one, you can't use Markdown, so use <code>&lt;code&gt;</code> blocks to denote code.</aside>
<h3 id='http-request-2'>HTTP Request</h3>
<p><code>GET http://example.com/kittens/&lt;ID&gt;</code></p>
<h3 id='url-parameters'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ID</td>
<td>The ID of the kitten to retrieve</td>
</tr>
</tbody></table>
<h2 id='delete-a-specific-kitten'>Delete a Specific Kitten</h2><div class="highlight"><pre class="highlight ruby tab-ruby"><code><span class="nb">require</span> <span class="s1">'kittn'</span>

<span class="n">api</span> <span class="o">=</span> <span class="no">Kittn</span><span class="o">::</span><span class="no">APIClient</span><span class="p">.</span><span class="nf">authorize!</span><span class="p">(</span><span class="s1">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="nf">kittens</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight python tab-python"><code><span class="kn">import</span> <span class="nn">kittn</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">kittn</span><span class="p">.</span><span class="n">authorize</span><span class="p">(</span><span class="s">'meowmeowmeow'</span><span class="p">)</span>
<span class="n">api</span><span class="p">.</span><span class="n">kittens</span><span class="p">.</span><span class="n">delete</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="highlight shell tab-shell"><code>curl <span class="s2">"http://example.com/api/kittens/2"</span> <span class="se">\</span>
  <span class="nt">-X</span> DELETE <span class="se">\</span>
  <span class="nt">-H</span> <span class="s2">"Authorization: meowmeowmeow"</span>
</code></pre></div><div class="highlight"><pre class="highlight javascript tab-javascript"><code><span class="kd">const</span> <span class="nx">kittn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">kittn</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">let</span> <span class="nx">api</span> <span class="o">=</span> <span class="nx">kittn</span><span class="p">.</span><span class="nx">authorize</span><span class="p">(</span><span class="dl">'</span><span class="s1">meowmeowmeow</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">let</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">api</span><span class="p">.</span><span class="nx">kittens</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div>
<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
  </span><span class="nl">"deleted"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">":("</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>This endpoint deletes a specific kitten.</p>
<h3 id='http-request-3'>HTTP Request</h3>
<p><code>DELETE http://example.com/kittens/&lt;ID&gt;</code></p>
<h3 id='url-parameters-2'>URL Parameters</h3>
<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>ID</td>
<td>The ID of the kitten to delete</td>
</tr>
</tbody></table>
<h1 id='errors'>Errors</h1>
<aside class="notice">
This error section is stored in a separate file in <code>includes/_errors.md</code>. Slate allows you to optionally separate out your docs into many files...just save them to the <code>includes</code> folder and add them to the top of your <code>index.md</code>'s frontmatter. Files are included in the order listed.
</aside>

<p>The Kittn API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request -- Your request is invalid.</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized -- Your API key is wrong.</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden -- The kitten requested is hidden for administrators only.</td>
</tr>
<tr>
<td>404</td>
<td>Not Found -- The specified kitten could not be found.</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed -- You tried to access a kitten with an invalid method.</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable -- You requested a format that isn&#39;t json.</td>
</tr>
<tr>
<td>410</td>
<td>Gone -- The kitten requested has been removed from our servers.</td>
</tr>
<tr>
<td>418</td>
<td>I&#39;m a teapot.</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests -- You&#39;re requesting too many kittens! Slow down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error -- We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable -- We&#39;re temporarily offline for maintenance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="c">c</a>
                <a href="#" data-language-name="rust">rust</a>
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="csharp">csharp</a>
                <a href="#" data-language-name="java">java</a>
          </div>
      </div>
    </div>
  </body>
</html>
