(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{123:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return s})),r.d(t,"toc",(function(){return l})),r.d(t,"default",(function(){return p}));var o=r(3),n=r(7),a=(r(0),r(156)),i={title:"Protocol Design Whitepaper",language_tabs:["c","rust","python","csharp","java"],toc_footers:["<a href='https://www.zerotier.com'>ZeroTier Homepage</a>","<a href='#'>Sign Up for Central API Key</a>","<a href='https://github.com/zerotier/libzt'>GitHub</a>"],includes:["errors"],search:!0,code_clipboard:!0,custom_edit_url:null},s={unversionedId:"zerotier/manual.html",id:"zerotier/manual.html",isDocsHomePage:!1,title:"Protocol Design Whitepaper",description:"Introduction",source:"@site/docs/zerotier/manual.html.md",sourceDirName:"zerotier",slug:"/zerotier/manual.html",permalink:"/zerotier/manual.html",editUrl:null,version:"current",frontMatter:{title:"Protocol Design Whitepaper",language_tabs:["c","rust","python","csharp","java"],toc_footers:["<a href='https://www.zerotier.com'>ZeroTier Homepage</a>","<a href='#'>Sign Up for Central API Key</a>","<a href='https://github.com/zerotier/libzt'>GitHub</a>"],includes:["errors"],search:!0,code_clipboard:!0,custom_edit_url:null},sidebar:"docsSidebar",previous:{title:"ZeroTier One",permalink:"/zerotier/ztintro"},next:{title:"Multipath",permalink:"/zerotier/multipath"}},l=[{value:"Introduction",id:"introduction",children:[]},{value:"Network Hypervisor Overview",id:"network-hypervisor-overview",children:[{value:"VL1: The ZeroTier Peer to Peer Network",id:"vl1-the-zerotier-peer-to-peer-network",children:[]},{value:"Network Topology and Peer Discovery",id:"network-topology-and-peer-discovery",children:[]},{value:"Addressing",id:"addressing",children:[]}]}],c={toc:l};function p(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},c,r,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"introduction"},"Introduction"),Object(a.b)("p",null,"ZeroTier is a smart Ethernet switch for planet Earth."),Object(a.b)("p",null,"It's a distributed network hypervisor built atop a cryptographically secure global peer to peer network. It provides advanced network virtualization and management capabilities on par with an enterprise SDN switch, but across both local and wide area networks and connecting almost any kind of app or device."),Object(a.b)("p",null,"This manual describes the design and operation of ZeroTier and its associated services, apps, and libraries. Its intended audience includes IT professionals, network administrators, information security experts, and developers."),Object(a.b)("p",null,"The first section (2) of this guide explains ZeroTier's design and operation at a high level and is written for those with at least an intermediate knowledge of topics like TCP/IP and Ethernet networking. It's not required reading for most users, but understanding how things work in detail helps clarify everything else and helps tremendously with troubleshooting should anything go wrong."),Object(a.b)("p",null,"The remaining sections deal more concretely with deployment and administration."),Object(a.b)("hr",null),Object(a.b)("h2",{id:"network-hypervisor-overview"},"Network Hypervisor Overview"),Object(a.b)("p",null,"The ZeroTier network hypervisor (currently found in the ",Object(a.b)("a",{parentName:"p",href:"https://github.com/zerotier/ZeroTierOne/tree/master/node"},"node/")," subfolder of the ZeroTierOne git repository) is a self-contained network virtualization engine that implements an Ethernet virtualization layer similar to ",Object(a.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Virtual_Extensible_LAN"},"VXLAN")," on top of a global encrypted peer to peer network."),Object(a.b)("p",null,"The ZeroTier protocol is original, though aspects of it are similar to VXLAN and IPSec. It has two conceptually separate but closely coupled layers ",Object(a.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/OSI_model"},"in the OSI model")," sense: ",Object(a.b)("strong",{parentName:"p"},"VL1")," and ",Object(a.b)("strong",{parentName:"p"},"VL2"),'. VL1 is the underlying peer to peer transport layer, the "virtual wire," while VL2 is an emulated Ethernet layer that provides operating systems and apps with a familiar communication medium.'),Object(a.b)("h3",{id:"vl1-the-zerotier-peer-to-peer-network"},"VL1: The ZeroTier Peer to Peer Network"),Object(a.b)("p",null,"A global data center requires a global wire closet."),Object(a.b)("p",null,"In conventional networks L1 (OSI layer 1) refers to the actual CAT5/CAT6 cables or wireless radio channels over which data is carried and the physical transceiver chips that modulate and demodulate it. VL1 is a peer to peer network that does the same thing by using encryption, authentication, and a lot of networking tricks to create virtual wires on a dynamic as-needed basis."),Object(a.b)("h3",{id:"network-topology-and-peer-discovery"},"Network Topology and Peer Discovery"),Object(a.b)("p",null,"VL1 is designed to be zero-configuration. A user can start a new ZeroTier node without having to write configuration files or provide the IP addresses of other nodes. It's also designed to be fast. Any two devices in the world should be able to locate each other and communicate almost instantly."),Object(a.b)("p",null,"To achieve this VL1 is organized like DNS. At the base of the network is a collection of always-present ",Object(a.b)("strong",{parentName:"p"},"root servers")," whose role is similar to that of ",Object(a.b)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Root_name_server"},"DNS root name servers"),". Roots run the same software as regular endpoints but reside at fast stable locations on the network and are designated as such by a ",Object(a.b)("strong",{parentName:"p"},"world definition"),". World definitions come in two forms: the ",Object(a.b)("strong",{parentName:"p"},"planet")," and one or more ",Object(a.b)("strong",{parentName:"p"},"moons"),". The protocol includes a secure mechanism allowing world definitions to be updated in-band if root servers' IP addresses or ZeroTier addresses change."),Object(a.b)("p",null,"There is only one planet. Earth's root servers are operated by ZeroTier, Inc. as a free service. There are currently twelve root servers organized into two six-member clusters distributed across every major continent and multiple network providers. Almost everyone in the world has one within less than 100ms network latency from their location."),Object(a.b)("p",null,'A node can "orbit" any number of moons. A moon is just a convenient way to add user-defined root servers to the pool. Users can create moons to reduce dependency on ZeroTier, Inc. infrastructure or to locate root servers closer for better performance. For on-premise SDN use a cluster of root servers can be located inside a building or data center so that ZeroTier can continue to operate normally if Internet connectivity is lost.'),Object(a.b)("p",null,"Nodes start with no direct links to one another, only upstream to roots (planet and moons). Every peer on VL1 possesses a globally unique 40-bit (10 hex digit) ",Object(a.b)("strong",{parentName:"p"},"ZeroTier address"),', but unlike IP addresses these are opaque cryptographic identifiers that encode no routing information. To communicate peers first send packets "up" the tree, and as these packets traverse the network they trigger the opportunistic creation of direct links along the way. The tree is constantly trying to "collapse itself" to optimize itself to the pattern of traffic it is carrying.'),Object(a.b)("p",null,"Peer to peer connection setup goes like this:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"A wants to send a packet to B, but since it has no direct path it sends it upstream to R (a root)."),Object(a.b)("li",{parentName:"ol"},"If R has a direct link to B, it forwards the packet there. Otherwise it sends the packet upstream until planetary roots are reached. Planetary roots know about all nodes, so eventually the packet will reach B if B is online."),Object(a.b)("li",{parentName:"ol"},"R also sends a message called ",Object(a.b)("em",{parentName:"li"},"rendezvous")," to A containing hints about how it might reach B. Meanwhile the root that forwards the packet to B sends ",Object(a.b)("em",{parentName:"li"},"rendezvous")," informing B how it might reach A."),Object(a.b)("li",{parentName:"ol"},"A and B get their ",Object(a.b)("em",{parentName:"li"},"rendezvous")," messages and attempt to send test messages to each other, possibly accomplishing ",Object(a.b)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/UDP_hole_punching"},"hole punching")," of any NATs or stateful firewalls that happen to be in the way. If this works a direct link is established and packets no longer need to take the scenic route.")),Object(a.b)("p",null,"Since roots forward packets, A and B can reach each other instantly. A and B then begin attempting to make a direct peer to peer connection. If this succeeds it results in a faster lower latency link. We call this ",Object(a.b)("em",{parentName:"p"},"transport triggered link provisioning")," since it's the forwarding of the packet itself that triggers the peer to peer network to attempt direct connection."),Object(a.b)("p",null,"VL1 never gives up. If a direct path can't be established, communication can continue through (slower) relaying. Direct connection attempts continue forever on a periodic basis. VL1 also has other features for establishing direct connectivity including LAN peer discovery, port prediction for traversal of symmetric IPv4 NATs, and explicit port mapping using uPnP and/or NAT-PMP if these are available on the local physical LAN."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},Object(a.b)("a",{parentName:"em",href:"http://adamierymenko.com/decentralization-i-want-to-believe/"},"A blog post from 2014 by ZeroTier's original author explains some of the reasoning behind VL1's design."))),Object(a.b)("h3",{id:"addressing"},"Addressing"))}p.isMDXComponent=!0},156:function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return b}));var o=r(0),n=r.n(o);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=n.a.createContext({}),p=function(e){var t=n.a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=p(e.components);return n.a.createElement(c.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},u=n.a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(r),u=o,b=d["".concat(i,".").concat(u)]||d[u]||h[u]||a;return r?n.a.createElement(b,s(s({ref:t},c),{},{components:r})):n.a.createElement(b,s({ref:t},c))}));function b(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<a;c++)i[c]=r[c];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,r)}u.displayName="MDXCreateElement"}}]);