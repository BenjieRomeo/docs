(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{108:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return o})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return s}));var n=a(3),i=a(7),r=(a(0),a(156)),l={title:"Multipath",toc_footers:["<a href='https://www.zerotier.com'>ZeroTier Homepage</a>","<a href='#'>Sign Up for Central API Key</a>","<a href='https://github.com/zerotier/zerotierone'>GitHub</a>"],includes:["errors"],search:!0,code_clipboard:!0,custom_edit_url:null},o={unversionedId:"zerotier/multipath",id:"zerotier/multipath",isDocsHomePage:!1,title:"Multipath",description:"Link aggregation allows the simultaneous (or conditional) use of multiple physical links to enable increased throughput, load balancing, redundancy, and fault tolerance. There are a variety of standard policies available that can be used right out of the box with little to no configuration. These policies are directly inspired by the policies offered by the Linux kernel but are now offered in user-space and hence available on all platforms that ZeroTier supports.",source:"@site/docs/zerotier/multipath.md",sourceDirName:"zerotier",slug:"/zerotier/multipath",permalink:"/zerotier/multipath",editUrl:null,version:"current",frontMatter:{title:"Multipath",toc_footers:["<a href='https://www.zerotier.com'>ZeroTier Homepage</a>","<a href='#'>Sign Up for Central API Key</a>","<a href='https://github.com/zerotier/zerotierone'>GitHub</a>"],includes:["errors"],search:!0,code_clipboard:!0,custom_edit_url:null},sidebar:"docsSidebar",previous:{title:"Protocol Design Whitepaper",permalink:"/zerotier/manual.html"},next:{title:"ZeroTier SDK Core",permalink:"/libzt-c/zerotier-sdk"}},c=[{value:"Standard policies",id:"standard-policies",children:[]},{value:"Custom policies",id:"custom-policies",children:[]},{value:"Specifying links",id:"specifying-links",children:[]},{value:"Peer-specific bonds",id:"peer-specific-bonds",children:[]},{value:"Active backup (<code>active-backup</code>)",id:"active-backup-active-backup",children:[]},{value:"Broadcast (<code>broadcast</code>)",id:"broadcast-broadcast",children:[]},{value:"Balance round robin (<code>balance-rr</code>)",id:"balance-round-robin-balance-rr",children:[]},{value:"Balance XOR",id:"balance-xor",children:[]},{value:"Balance aware",id:"balance-aware",children:[]},{value:"Link quality",id:"link-quality",children:[]},{value:"Asymmetric links",id:"asymmetric-links",children:[]},{value:"Performance and overhead considerations",id:"performance-and-overhead-considerations",children:[]}],b={toc:c};function s(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"Link aggregation allows the simultaneous (or conditional) use of multiple physical links to enable increased throughput, load balancing, redundancy, and fault tolerance. There are a variety of standard policies available that can be used right out of the box with little to no configuration. These policies are directly inspired by ",Object(r.b)("a",{parentName:"p",href:"https://www.kernel.org/doc/Documentation/networking/bonding.txt"},"the policies offered by the Linux kernel")," but are now offered in user-space and hence available on all platforms that ZeroTier supports."),Object(r.b)("h2",{id:"standard-policies"},"Standard policies"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Policy name"),Object(r.b)("th",{parentName:"tr",align:"center"},"Fault tolerance"),Object(r.b)("th",{parentName:"tr",align:"right"},"Min. failover (sec.)"),Object(r.b)("th",{parentName:"tr",align:"right"},"Default Failover (sec.)"),Object(r.b)("th",{parentName:"tr",align:"right"},"Balancing"),Object(r.b)("th",{parentName:"tr",align:"right"},"Aggregation efficiency"),Object(r.b)("th",{parentName:"tr",align:"right"},"Redundancy"),Object(r.b)("th",{parentName:"tr",align:"right"},"Sequence Reordering"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"none")),Object(r.b)("td",{parentName:"tr",align:"center"},"None"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"60+")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"60+")),Object(r.b)("td",{parentName:"tr",align:"right"},"none"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"none")),Object(r.b)("td",{parentName:"tr",align:"right"},"1"),Object(r.b)("td",{parentName:"tr",align:"right"},"No")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"active-backup")),Object(r.b)("td",{parentName:"tr",align:"center"},"Brief interruption"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"0.25")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"10")),Object(r.b)("td",{parentName:"tr",align:"right"},"none"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"low")),Object(r.b)("td",{parentName:"tr",align:"right"},"1"),Object(r.b)("td",{parentName:"tr",align:"right"},"Only during failover")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"broadcast")),Object(r.b)("td",{parentName:"tr",align:"center"},"Fully tolerant"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"N/A")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"N/A")),Object(r.b)("td",{parentName:"tr",align:"right"},"none"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"very low")),Object(r.b)("td",{parentName:"tr",align:"right"},"N"),Object(r.b)("td",{parentName:"tr",align:"right"},"Often")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"balance-rr")),Object(r.b)("td",{parentName:"tr",align:"center"},"Self-healing"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"0.25")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"10")),Object(r.b)("td",{parentName:"tr",align:"right"},"packet-based"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"high")),Object(r.b)("td",{parentName:"tr",align:"right"},"1"),Object(r.b)("td",{parentName:"tr",align:"right"},"Often")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"balance-xor")),Object(r.b)("td",{parentName:"tr",align:"center"},"Self-healing"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"0.25")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"10")),Object(r.b)("td",{parentName:"tr",align:"right"},"flow-based"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"very high")),Object(r.b)("td",{parentName:"tr",align:"right"},"1"),Object(r.b)("td",{parentName:"tr",align:"right"},"Only during failover")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},Object(r.b)("inlineCode",{parentName:"td"},"balance-aware")),Object(r.b)("td",{parentName:"tr",align:"center"},"Self-healing"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"0.25")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"10")),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("em",{parentName:"td"},"adaptive")," flow-based"),Object(r.b)("td",{parentName:"tr",align:"right"},Object(r.b)("inlineCode",{parentName:"td"},"very high")),Object(r.b)("td",{parentName:"tr",align:"right"},"1"),Object(r.b)("td",{parentName:"tr",align:"right"},"Only during failover and re-balance")))),Object(r.b)("p",null,"A policy can be used easily without specifying any additional parameters:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n    "settings": {\n        "defaultBondingPolicy": "active-backup"\n    }\n}\n')),Object(r.b)("h2",{id:"custom-policies"},"Custom policies"),Object(r.b)("p",null,"To customize a bonding policy for your use-case simply specify a ",Object(r.b)("inlineCode",{parentName:"p"},"basePolicy")," and override chosen parameters. For example, to create a more aggressive ",Object(r.b)("inlineCode",{parentName:"p"},"active-backup")," policy with low monitoring overhead that will failover ",Object(r.b)("inlineCode",{parentName:"p"},"0.250")," seconds after it detects a link failure, one could do the following:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "settings":\n  {\n    "defaultBondingPolicy": "aggressive-active-backup",\n    "policies":\n    {\n      "aggressive-active-backup":\n      {\n        "failoverInterval": 250,\n        "pathMonitorStrategy": "dynamic",\n        "basePolicy": "active-backup"\n      }\n    }\n  }\n}\n')),Object(r.b)("h2",{id:"specifying-links"},"Specifying links"),Object(r.b)("p",null,"Bonds are composed of multiple ",Object(r.b)("inlineCode",{parentName:"p"},"links"),". Different sets of links can be constructed for different bonding policies and used simultaneously. One can specify the links that ZeroTier should use in any given bonding policy simply by providing an array of links with names corresponding to interface names. If a user doesn't specify a set of interfaces to use, ZeroTier will assume every system interface is available for use. However, if the user ",Object(r.b)("strong",{parentName:"p"},"does")," specify a set of interfaces, ZeroTier will only use what is specified. The same applies to failover rules, if none are specified, ZeroTier will failover to any operational link. On the other hand, if the user does specify failover rules and there is ever a situation where a link is available for usage but does not fit within the rules specified by the user, it will go unused."),Object(r.b)("p",null,"To specify that ZeroTier should only use ",Object(r.b)("inlineCode",{parentName:"p"},"eth0")," and ",Object(r.b)("inlineCode",{parentName:"p"},"eth1")," as primary links, and ",Object(r.b)("inlineCode",{parentName:"p"},"eth2")," as a backup spare and that it should prefer IPv4 over IPv6 except on ",Object(r.b)("inlineCode",{parentName:"p"},"eth2")," where only IPv6 is allowed:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "settings": {\n    "defaultBondingPolicy": "aggressive-active-backup",\n    "policies": {\n      "aggressive-active-backup": {\n        "links": {\n          "eth0": {\n            "ipvPref": 46,\n            "failoverTo": "eth2",\n            "mode": "primary"\n          },\n          "eth1": {\n            "ipvPref": 46,\n            "failoverTo": "eth2",\n            "mode": "primary"\n          },\n          "eth2": {\n            "ipvPref": 6,\n            "mode": "spare"\n          }\n        }\n      }\n    }\n  }\n}\n')),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"Additional link-specific parameters")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-javascript"},'"links":\n{\n  "interfaceName": /* System-name of the network interface. */\n  {\n    "failoverInterval": 0-65535, /* (optional) How quickly a path on this link should failover after a detected failure. */\n    "ipvPref": [0,4,6,46,64], /* (optional) IP version preference for detected paths on a link. */\n    "speed": 0-1000000, /* (optional) How fast this link is (in arbitrary units). This is a useful way to manually allocate a bond. */\n    "alloc": 0-255, /* (optional) A relative value representing a desired allocation. */\n    "upDelay": 0-65535, /* (optional) How long after a path becomes alive before it is added to the bond. */\n    "downDelay": 0-65535, /* (optional) How long after a path fails before it is removed from the bond. */\n    "failoverTo": "spareInterfaceName", /* (optional) Which link should be used next after a failure of this link. */\n    "enabled": true|false, /* (optional) Whether any paths on this link are allowed to be used this bond. */\n    "mode": "primary"|"spare" /* (optional) Whether this link is used by default or only after failover events. */\n  }\n}\n')),Object(r.b)("h2",{id:"peer-specific-bonds"},"Peer-specific bonds"),Object(r.b)("p",null,"It is possible to direct ZeroTier to form a certain type of bond with specific peers of your choice. For instance, if one were to want ",Object(r.b)("inlineCode",{parentName:"p"},"active-backup")," by default but for certain peers to be bonded with a custom load-balanced bond such as ",Object(r.b)("inlineCode",{parentName:"p"},"my-custom-balance-aware")," one could do the following:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "settings":\n  {\n    "defaultBondingPolicy": "active-backup",\n    "policies":\n    {\n      "my-custom-balance-aware":\n      {\n        "failoverInterval": 2000,\n        "monitorStrategy": "dynamic",\n        "basePolicy": "balance-aware"\n      }\n    },\n    "peerSpecificBonds":\n    {\n      "f6203a2db3":"my-custom-balance-aware",\n      "45b0301da2":"my-custom-balance-aware",\n      "a92cb526fa":"my-custom-balance-aware"\n    }\n  }\n}\n')),Object(r.b)("h2",{id:"active-backup-active-backup"},"Active backup (",Object(r.b)("inlineCode",{parentName:"h2"},"active-backup"),")"),Object(r.b)("p",null,"Traffic is sent only on (one) path at any given time. A different path becomes active if the current path fails. This mode provides fault tolerance with a nearly immediate fail-over. This mode ",Object(r.b)("strong",{parentName:"p"},"does not")," increase total throughput."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"mode"),": ",Object(r.b)("inlineCode",{parentName:"p"},"primary, spare")," Link option which specifies which link is the primary device. The specified device is intended to always be the active link while it is available. There are exceptions to this behavior when using different ",Object(r.b)("inlineCode",{parentName:"p"},"linkSelectMethod")," modes. There can only be one ",Object(r.b)("inlineCode",{parentName:"p"},"primary")," link in this bonding policy.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"linkSelectMethod"),": Specifies the selection policy for the active link during failure and/or recovery events. This is similar to the Linux Kernel's ",Object(r.b)("inlineCode",{parentName:"p"},"primary_reselect")," option but with a minor extension:"),Object(r.b)("ul",{parentName:"li"},Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"optimize"),": ",Object(r.b)("strong",{parentName:"li"},"(default if user provides no failover guidance)")," The primary link can change periodically if a superior path is detected."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"always"),": ",Object(r.b)("strong",{parentName:"li"},"(default when links are explicitly specified)"),": Primary link regains status as active link whenever it comes back up."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"better"),": Primary link regains status as active link when it comes back up and (if) it is better than the currently-active link."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"failure"),": Primary link regains status as active link only if the currently-active link fails.")))),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "settings":\n  {\n    "defaultBondingPolicy": "active-backup",\n    "active-backup":\n    {\n      "linkSelectMethod": "always",\n      "links":\n      {\n        "eth0": { "failoverTo": "eth1", "mode": "primary" },\n        "eth1": { "mode": "spare" },\n        "eth2": { "mode": "spare" },\n        "eth3": { "mode": "spare" }\n      }\n    }\n  }\n}\n')),Object(r.b)("h2",{id:"broadcast-broadcast"},"Broadcast (",Object(r.b)("inlineCode",{parentName:"h2"},"broadcast"),")"),Object(r.b)("p",null,"Traffic is sent on (all) available paths simultaneously. This mode provides fault tolerance and effectively immediate failover due to transmission redundancy. This mode is a poor utilization of throughput resources and will ",Object(r.b)("strong",{parentName:"p"},"not")," increase throughput but can prevent packet loss during a link failure. The only option available is ",Object(r.b)("inlineCode",{parentName:"p"},"dedup")," which will de-duplicate all packets on the receiving end if set to ",Object(r.b)("inlineCode",{parentName:"p"},"true"),"."),Object(r.b)("h2",{id:"balance-round-robin-balance-rr"},"Balance round robin (",Object(r.b)("inlineCode",{parentName:"h2"},"balance-rr"),")"),Object(r.b)("p",null,"Traffic is striped across multiple paths. Offers partial fault tolerance immediately, full fault tolerance eventually. This policy is unaware of protocols and is primarily intended for use with protocols that are not sensitive to reordering delays. The only option available for this policy is ",Object(r.b)("inlineCode",{parentName:"p"},"packetsPerLink")," which specifies the number of packets to transmit via a path before moving to the next in the RR sequence. When set to ",Object(r.b)("inlineCode",{parentName:"p"},"0")," a path is chosen at random for each outgoing packet. The default value is ",Object(r.b)("inlineCode",{parentName:"p"},"8"),", low values can begin to add overhead to packet processing."),Object(r.b)("h2",{id:"balance-xor"},"Balance XOR"),Object(r.b)("aside",{class:"notice"},"Similar to the Linux kernel's ",Object(r.b)("a",{href:"https://www.kernel.org/doc/Documentation/networking/bonding.txt"},"balance-xor")," modes with ",Object(r.b)("code",null,"xmit_hash_policy=layer3+4"),"."),Object(r.b)("p",null,"Traffic is categorized into ",Object(r.b)("em",{parentName:"p"},"flows")," based on ",Object(r.b)("em",{parentName:"p"},"source port"),", ",Object(r.b)("em",{parentName:"p"},"destination port"),", and ",Object(r.b)("em",{parentName:"p"},"protocol type")," these flows are then hashed onto available links. Each flow will persist on its assigned link interface for its entire life-cycle. Traffic that does not have an assigned port (such as ICMP pings) will be randomly distributed across links. The hash function is simply: ",Object(r.b)("inlineCode",{parentName:"p"},"src_port ^ dst_port ^ proto"),"."),Object(r.b)("h2",{id:"balance-aware"},"Balance aware"),Object(r.b)("aside",{class:"notice"},"Similar to the Linux kernel's ",Object(r.b)("a",{href:"https://www.kernel.org/doc/Documentation/networking/bonding.txt"},"balance-*lb")," modes."),Object(r.b)("p",null,"Traffic is dynamically allocated and balanced across multiple links simultaneously according to the target allocation. Options allow for ",Object(r.b)("em",{parentName:"p"},"packet")," or ",Object(r.b)("em",{parentName:"p"},"flow-based")," processing, and active-flow reassignment. Flows mediated over a recently failed links will be reassigned in a manner that respects the target allocation of the bond. An optional ",Object(r.b)("inlineCode",{parentName:"p"},"balancePolicy")," can be specified with the following effects: ",Object(r.b)("inlineCode",{parentName:"p"},"flow-dynamic")," (default) will hash flows onto links according to target allocation and may perform periodic re-assignments in order to preserve balance. ",Object(r.b)("inlineCode",{parentName:"p"},"flow-static"),", will hash flows onto links according to target allocation but will not re-assign flows unless a failure occurs or the link is no longer operating within acceptable parameters. And lastly ",Object(r.b)("inlineCode",{parentName:"p"},"packet")," which simply load balances packets across links according to target allocation but with no concern for sequence reordering."),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n    "settings":\n    {\n        "defaultBondingPolicy": "balance-aware",\n        "balance-aware": {\n            "balancePolicy": "flow-dynamic"|"flow-static"|"packet"\n        }\n    }\n}\n')),Object(r.b)("h2",{id:"link-quality"},"Link quality"),Object(r.b)("p",null,"ZeroTier measures various properties of a link (such as latency, throughput, jitter, packet loss ratio, etc) in order to arrive at a quality estimate. This estimate is used by bonding policies to make allocation and failover decisions:"),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:"left"},"Policy name"),Object(r.b)("th",{parentName:"tr",align:"left"},"Role"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:"left"},Object(r.b)("inlineCode",{parentName:"td"},"active-backup")),Object(r.b)("td",{parentName:"tr",align:"left"},"Determines the order of the failover queue. And if ",Object(r.b)("inlineCode",{parentName:"td"},"activeReselect=optimize")," whether a new active link is selected.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:"left"},Object(r.b)("inlineCode",{parentName:"td"},"broadcast")),Object(r.b)("td",{parentName:"tr",align:"left"},"Does not use quality measurements.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:"left"},Object(r.b)("inlineCode",{parentName:"td"},"balance-rr")),Object(r.b)("td",{parentName:"tr",align:"left"},"May trigger removal of link from bond.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:"left"},Object(r.b)("inlineCode",{parentName:"td"},"balance-xor")),Object(r.b)("td",{parentName:"tr",align:"left"},"May trigger removal of link from bond.")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:"left"},Object(r.b)("inlineCode",{parentName:"td"},"balance-aware")),Object(r.b)("td",{parentName:"tr",align:"left"},"Informs flow assignments and (re-)assignments. May trigger removal of link from bond.")))),Object(r.b)("p",null,"A link's eligibility for being included in a bond is dependent on more than perceived quality. If a path on a link begins to exhibit disruptive behavior such as extremely high packet loss, corruption, or periodic inability to process traffic it will be removed from the bond, its traffic will be appropriately reallocated and it will be punished. Punishments gradually fade and a link can be readmitted to the bond over time. However, punishments increase exponentially if applied more than once within a given window of time."),Object(r.b)("h2",{id:"asymmetric-links"},"Asymmetric links"),Object(r.b)("p",null,"In cases where it is necessary to bond physical links that vary radically in terms of cost, throughput, latency, and or reliability, there are a couple of ways to automatically (or manually) allocate traffic among them. Traffic distribution and balancing can be either ",Object(r.b)("inlineCode",{parentName:"p"},"packet")," or ",Object(r.b)("inlineCode",{parentName:"p"},"flow")," based. Where packet-based is suitable for protocols not susceptible to reordering penalties and flow-based is suitable for protocols such as TCP where it is desirable to keep a conversation on a single link unless we can't avoid having to re-assign it. Additionally, a ",Object(r.b)("em",{parentName:"p"},"target allocation")," of traffic used by the bonding policy can be derived/specified in the following ways:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Automatically"),": This is the easiest and requires no user configuration. The bonding layer measures and senses the link properties and determines a target allocation based on perceived quality and capacity. Weaker, less reliable links will have less traffic allocated to them and stronger, more reliable links will have more traffic allocated to them. Optionally, the user can specify a set of weights (totaling ",Object(r.b)("inlineCode",{parentName:"li"},"1.0"),") to inform the bonding layer how important certain link properties are. For instance, one may primarily be concerned with latency and jitter but not total throughput:")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'"balance-aware": {\n    "quality": {\n        "lat": 0.3, /* Moving average of latency in milliseconds */\n        "ltm": 0.2, /* Maximum observed latency in milliseconds */\n        "pdv": 0.3, /* Packet delay variance in milliseconds. Similar to jitter */\n        "plr": 0.1, /* Packet loss ratio */\n        "per": 0.1, /* Packet error ratio */\n        "avl": 0.0, /* Availability */\n    }\n}\n')),Object(r.b)("p",null,"In the absence of user guidance ZeroTier will attempt to form an understanding of each link's speed and capacity but this value can be inaccurate if the links are not routinely saturated. Therefore we provide a way to explicitly signal the capacity of each link in terms of arbitrary but relative values:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'"links": {\n  "eth0": { "speed": 10000 },\n  "eth1": { "speed": 1000 },\n  "eth2": { "speed": 100 }\n}\n')),Object(r.b)("p",null,"The user specifies allocation percentages (totaling ",Object(r.b)("inlineCode",{parentName:"p"},"1.0"),"). In this case quality measurements will only be used to determine a link's eligibility to be a member of a bond, now how much traffic it will carry:"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"local.conf snippet")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'"links": {\n  "eth0": { "alloc": 0.50 },\n  "eth1": { "alloc": 0.25 },\n  "eth2": { "alloc": 0.25 }\n}\n')),Object(r.b)("h2",{id:"performance-and-overhead-considerations"},"Performance and overhead considerations"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Only packets with internal IDs divisible by ",Object(r.b)("inlineCode",{parentName:"li"},"16")," are included in measurements, this amounts to about ",Object(r.b)("inlineCode",{parentName:"li"},"6.25%")," of all traffic."),Object(r.b)("li",{parentName:"ul"},Object(r.b)("inlineCode",{parentName:"li"},"failoverInterval")," specifies how quickly failover should occur during a link failure. In order to accomplish this a combination of active and passive measurement techniques are employed which may result in ",Object(r.b)("inlineCode",{parentName:"li"},"VERB_HELLO")," probes being sent every ",Object(r.b)("inlineCode",{parentName:"li"},"failoverInterval / 4")," time units. As a mitigation ",Object(r.b)("inlineCode",{parentName:"li"},"monitorStrategy")," may be set to ",Object(r.b)("inlineCode",{parentName:"li"},"dynamic")," so that probe frequency directly correlates with native application traffic.")))}s.isMDXComponent=!0},156:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),i=a.n(n);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var b=i.a.createContext({}),s=function(e){var t=i.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=s(e.components);return i.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,r=e.originalType,l=e.parentName,b=c(e,["components","mdxType","originalType","parentName"]),p=s(a),m=n,u=p["".concat(l,".").concat(m)]||p[m]||d[m]||r;return a?i.a.createElement(u,o(o({ref:t},b),{},{components:a})):i.a.createElement(u,o({ref:t},b))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=a.length,l=new Array(r);l[0]=m;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:n,l[1]=o;for(var b=2;b<r;b++)l[b]=a[b];return i.a.createElement.apply(null,l)}return i.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);