<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ZeroTier Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ZeroTier Documentation Blog Atom Feed"><title data-react-helmet="true">Protocol Design Whitepaper | ZeroTier Documentation</title><meta data-react-helmet="true" property="og:url" content="https://docs.zerotier.com/zerotier/manual.html"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Protocol Design Whitepaper | ZeroTier Documentation"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.zerotier.com/zerotier/manual.html"><link data-react-helmet="true" rel="alternate" href="https://docs.zerotier.com/zerotier/manual.html" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.zerotier.com/zerotier/manual.html" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ac863d77.css">
<link rel="preload" href="/assets/js/styles.677a4bb9.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.4cd1716d.js" as="script">
<link rel="preload" href="/assets/js/main.777a9448.js" as="script">
<link rel="preload" href="/assets/js/1.accfc5a0.js" as="script">
<link rel="preload" href="/assets/js/2.4213ea57.js" as="script">
<link rel="preload" href="/assets/js/82.828490fa.js" as="script">
<link rel="preload" href="/assets/js/84.6387da1f.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.7ac3aafe.js" as="script">
<link rel="preload" href="/assets/js/17896441.66d6057f.js" as="script">
<link rel="preload" href="/assets/js/b361220e.21d8c319.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/ZeroTierIcon.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/ZeroTierIcon.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ZeroTier Documentation</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/ZeroTierIcon.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/ZeroTierIcon.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">ZeroTier Documentation</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/">Welcome</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">ZeroTier</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zerotier/ztintro">ZeroTier One</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/zerotier/manual.html">Protocol Design Whitepaper</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zerotier/multipath">Multipath</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">libzt SDK</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/libzt-c/zerotier-sdk">ZeroTier SDK Core</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/libzt-c/tutorial.html">Tutorial</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API Docs</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">REST APIs</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Central</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/centralv1">V1</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Service</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/servicev1">V1</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">ZeroTierOne C API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/autogen/libztcore/files/_zero_tier_one_8h">ZeroTierOne.h</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/autogen/libztcore/index_classes">Classes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">libzt C API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/autogen/libzt/files/_zero_tier_sockets_8h">include/ZeroTierSockets.h</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/autogen/libzt/index_classes">Classes</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Protocol Design Whitepaper</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p>ZeroTier is a smart Ethernet switch for planet Earth.</p><p>It&#x27;s a distributed network hypervisor built atop a cryptographically secure global peer to peer network. It provides advanced network virtualization and management capabilities on par with an enterprise SDN switch, but across both local and wide area networks and connecting almost any kind of app or device.</p><p>This manual describes the design and operation of ZeroTier and its associated services, apps, and libraries. Its intended audience includes IT professionals, network administrators, information security experts, and developers.</p><p>The first section (2) of this guide explains ZeroTier&#x27;s design and operation at a high level and is written for those with at least an intermediate knowledge of topics like TCP/IP and Ethernet networking. It&#x27;s not required reading for most users, but understanding how things work in detail helps clarify everything else and helps tremendously with troubleshooting should anything go wrong.</p><p>The remaining sections deal more concretely with deployment and administration.</p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="network-hypervisor-overview"></a>Network Hypervisor Overview<a class="hash-link" href="#network-hypervisor-overview" title="Direct link to heading">#</a></h2><p>The ZeroTier network hypervisor (currently found in the <a href="https://github.com/zerotier/ZeroTierOne/tree/master/node" target="_blank" rel="noopener noreferrer">node/</a> subfolder of the ZeroTierOne git repository) is a self-contained network virtualization engine that implements an Ethernet virtualization layer similar to <a href="https://en.wikipedia.org/wiki/Virtual_Extensible_LAN" target="_blank" rel="noopener noreferrer">VXLAN</a> on top of a global encrypted peer to peer network.</p><p>The ZeroTier protocol is original, though aspects of it are similar to VXLAN and IPSec. It has two conceptually separate but closely coupled layers <a href="https://en.wikipedia.org/wiki/OSI_model" target="_blank" rel="noopener noreferrer">in the OSI model</a> sense: <strong>VL1</strong> and <strong>VL2</strong>. VL1 is the underlying peer to peer transport layer, the &quot;virtual wire,&quot; while VL2 is an emulated Ethernet layer that provides operating systems and apps with a familiar communication medium.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="vl1-the-zerotier-peer-to-peer-network"></a>VL1: The ZeroTier Peer to Peer Network<a class="hash-link" href="#vl1-the-zerotier-peer-to-peer-network" title="Direct link to heading">#</a></h3><p>A global data center requires a global wire closet.</p><p>In conventional networks L1 (OSI layer 1) refers to the actual CAT5/CAT6 cables or wireless radio channels over which data is carried and the physical transceiver chips that modulate and demodulate it. VL1 is a peer to peer network that does the same thing by using encryption, authentication, and a lot of networking tricks to create virtual wires on a dynamic as-needed basis.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="network-topology-and-peer-discovery"></a>Network Topology and Peer Discovery<a class="hash-link" href="#network-topology-and-peer-discovery" title="Direct link to heading">#</a></h3><p>VL1 is designed to be zero-configuration. A user can start a new ZeroTier node without having to write configuration files or provide the IP addresses of other nodes. It&#x27;s also designed to be fast. Any two devices in the world should be able to locate each other and communicate almost instantly.</p><p>To achieve this VL1 is organized like DNS. At the base of the network is a collection of always-present <strong>root servers</strong> whose role is similar to that of <a href="https://en.wikipedia.org/wiki/Root_name_server" target="_blank" rel="noopener noreferrer">DNS root name servers</a>. Roots run the same software as regular endpoints but reside at fast stable locations on the network and are designated as such by a <strong>world definition</strong>. World definitions come in two forms: the <strong>planet</strong> and one or more <strong>moons</strong>. The protocol includes a secure mechanism allowing world definitions to be updated in-band if root servers&#x27; IP addresses or ZeroTier addresses change.</p><p>There is only one planet. Earth&#x27;s root servers are operated by ZeroTier, Inc. as a free service. There are currently twelve root servers organized into two six-member clusters distributed across every major continent and multiple network providers. Almost everyone in the world has one within less than 100ms network latency from their location.</p><p>A node can &quot;orbit&quot; any number of moons. A moon is just a convenient way to add user-defined root servers to the pool. Users can create moons to reduce dependency on ZeroTier, Inc. infrastructure or to locate root servers closer for better performance. For on-premise SDN use a cluster of root servers can be located inside a building or data center so that ZeroTier can continue to operate normally if Internet connectivity is lost.</p><p>Nodes start with no direct links to one another, only upstream to roots (planet and moons). Every peer on VL1 possesses a globally unique 40-bit (10 hex digit) <strong>ZeroTier address</strong>, but unlike IP addresses these are opaque cryptographic identifiers that encode no routing information. To communicate peers first send packets &quot;up&quot; the tree, and as these packets traverse the network they trigger the opportunistic creation of direct links along the way. The tree is constantly trying to &quot;collapse itself&quot; to optimize itself to the pattern of traffic it is carrying.</p><p>Peer to peer connection setup goes like this:</p><ol><li>A wants to send a packet to B, but since it has no direct path it sends it upstream to R (a root).</li><li>If R has a direct link to B, it forwards the packet there. Otherwise it sends the packet upstream until planetary roots are reached. Planetary roots know about all nodes, so eventually the packet will reach B if B is online.</li><li>R also sends a message called <em>rendezvous</em> to A containing hints about how it might reach B. Meanwhile the root that forwards the packet to B sends <em>rendezvous</em> informing B how it might reach A.</li><li>A and B get their <em>rendezvous</em> messages and attempt to send test messages to each other, possibly accomplishing <a href="https://en.wikipedia.org/wiki/UDP_hole_punching" target="_blank" rel="noopener noreferrer">hole punching</a> of any NATs or stateful firewalls that happen to be in the way. If this works a direct link is established and packets no longer need to take the scenic route.</li></ol><p>Since roots forward packets, A and B can reach each other instantly. A and B then begin attempting to make a direct peer to peer connection. If this succeeds it results in a faster lower latency link. We call this <em>transport triggered link provisioning</em> since it&#x27;s the forwarding of the packet itself that triggers the peer to peer network to attempt direct connection.</p><p>VL1 never gives up. If a direct path can&#x27;t be established, communication can continue through (slower) relaying. Direct connection attempts continue forever on a periodic basis. VL1 also has other features for establishing direct connectivity including LAN peer discovery, port prediction for traversal of symmetric IPv4 NATs, and explicit port mapping using uPnP and/or NAT-PMP if these are available on the local physical LAN.</p><p><em><a href="http://adamierymenko.com/decentralization-i-want-to-believe/" target="_blank" rel="noopener noreferrer">A blog post from 2014 by ZeroTier&#x27;s original author explains some of the reasoning behind VL1&#x27;s design.</a></em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="addressing"></a>Addressing<a class="hash-link" href="#addressing" title="Direct link to heading">#</a></h3></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zerotier/ztintro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« ZeroTier One</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/zerotier/multipath"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multipath Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a></li><li><a href="#network-hypervisor-overview" class="table-of-contents__link">Network Hypervisor Overview</a><ul><li><a href="#vl1-the-zerotier-peer-to-peer-network" class="table-of-contents__link">VL1: The ZeroTier Peer to Peer Network</a></li><li><a href="#network-topology-and-peer-discovery" class="table-of-contents__link">Network Topology and Peer Discovery</a></li><li><a href="#addressing" class="table-of-contents__link">Addressing</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zerotier/ztintro">ZeroTier</a></li><li class="footer__item"><a class="footer__link-item" href="/libzt/manual.html">libzt SDK</a></li><li class="footer__item"><a class="footer__link-item" href="/centralv1">Central API</a></li><li class="footer__item"><a class="footer__link-item" href="/servicev1">Service API</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discuss.zerotier.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">ZeroTier Discussions</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/zerotier/ZeroTierOne" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 ZeroTier, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.677a4bb9.js"></script>
<script src="/assets/js/runtime~main.4cd1716d.js"></script>
<script src="/assets/js/main.777a9448.js"></script>
<script src="/assets/js/1.accfc5a0.js"></script>
<script src="/assets/js/2.4213ea57.js"></script>
<script src="/assets/js/82.828490fa.js"></script>
<script src="/assets/js/84.6387da1f.js"></script>
<script src="/assets/js/935f2afb.7ac3aafe.js"></script>
<script src="/assets/js/17896441.66d6057f.js"></script>
<script src="/assets/js/b361220e.21d8c319.js"></script>
</body>
</html>